---
title: "How to Use 'crtcr'"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to Use 'crtcr'}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Convergent Recombination of TCR Clones

# Guide to crtcr R package

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Installation

CRAN

```{r}
install.packages("crtcr")
```

GitHub

```{r}
# devtools::install_github("systemsbiomed/crtcr")
```

## Data transformation - clones vs. clonotype

### same sequence different clone example

```{r}

rep_df <- rand_rep_df(1000, 3) %>% 
  
  mutate(attr=gl(2, 2, length = 1000, labels = c("Vx", "Vy"))) %>% 
  
  unique()

sapply(list(rep_df, rep_df[c("nt", "aa")]), n_distinct)

```

Differentiating by the nucleotide sequence
```{r}
# check_clonotype
```

differentiating by the the V-segments of the CDR3 amino acid sequence
```{r}
# check_clonotype_v
```

differentiating by multiple attributes of the CDR3 amino acid sequence like the\
CDR3's nucleotide sequence and also its V- and J-segment
```{r}
# check_clonotype_
```

## Data types
### for cr-level functions
repertoire's clonotypes - of individual/sample - as a character vector - as a data frame \### for share-level functions population's clonotypes - group of individuals with characteristic in common (such as test or control group) - as a list of character vectors - as a list of data frames - a data frame with id column \### for cr-type functions multiple populations' clonotypes - multiple groups to be compared - as list of - list of character vectors - population vectors - as list of - list of data frames - population's combined data frame with id column - as a data frame with with two id columns, one for the individual and one for the group


```{r}
get_clonotypes(rep_df, "aa", "nt")
```

```{r}

rep_list <- rand_group(3,3)

clonotype_list <- get_group_clonotype(df_list = rep_list, 
                                      clonotype_col="aa", 
                                      clone_col="nt")

sapply(clonotype_list, nrow)
 
```

```{r}
get_group_clonotype(rep_list, "aa", "nt", to_df = TRUE)
```

```{r}

rep_lists <- rand_populations(3,3,3) 
  
get_multiple_group_clonotype(df_list = rep_lists,
                             clonotype_col="aa", 
                             clone_col="nt", 
                             to_df=TRUE, 
                             group_to_df = TRUE) %>% 
  sample_n(3)
```

## Convergent recombination level (CR-level)

the right calculation is based on how a clone is defined. use the previous function to adjust data or the 'clone_by' field

-   CR-level of a clonotype
-   CR-level across repertoire
-   CR-level in a group
-   Compare CR-level by different "clone definitions"

cr_level - this function execute the following by the of argument

```{r}
# cr_level
```

cr_level_clonotype - CR-level value of a clonotype in a repertoire

```{r}

rand_rep_df(seq_n=1000, seq_l=3) %>%
  
  cr_level_clonotype(c("S", "T", "M"), "aa","nt")

```

cr_level_rep - CR-level of all clonotype in a repertoire

```{r}

aa_vec <- pull(rand_rep_df(100), "aa") %>% 
  
cr_level_rep(aa_vec)


```

cr_level_group - CR-level across multiple populations' clonotypes

```{r}

rep_list <- rand_group(seq_n = 3)

rep_list <- cr_level_group(rep_list, "aa", "nt")

# rep_list <- rand_group(n_sample = 6, seq_n = 100) %>% map(pull, "aa")

# cr_tcl <- cr_level_group(rep_list)

head(cr_tcl)

```

cr_level_compare - computes CR-level for every clone definition

```{r}
# cr_level_compare
```

## repertoires sharing-level

-   of a population's clonotype
-   of multiple populations' clonotype
-   sharing-level conditioned by clone's property

```{r}
l <- replicate(6, sample(LETTERS, sample(13:18, 1, replace = TRUE)), simplify = FALSE)
share_level(l) # number of vectors a letter found in
```

single population - clonotype

```{r}


# shared_clonotype


```

single population - clone

```{r}
# shared_clone
```

multiple populations - clonotype

```{r}
# shared_population_clonotype
```

multiple populations - clone

```{r}
# shared_population_clone
```

## Convergent recombination classification

## Public clonotype subtypes

[explin]

-   private and public
-   public exclusive
-   public inclusive

```{r}
# public_cr
# cr_table
# factor_cr
# cr_list
```

### CR functions:

logical operation - is private - is public - is public exclusive - is public inclusive

Data transformation - add a column - split data frame - clonotype factor - clonotype label - clonotype list

Significant values by CR-type - CR-level to CR-type - share-level to CR-type - clone count - clone frequency

Pairwise resemblance (overlapping, similarity, correlation, distance, etc.) - individual-wise - population-wise - sub-populations-wise

```{r}
# cr_overlap
```
